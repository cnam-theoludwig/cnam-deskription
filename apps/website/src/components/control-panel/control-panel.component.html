<div class="card h-full bg-gradient-panel shadow-panel border-0">
  <div class="card-content space-y-6">
    <div class="space-y-3">
      <div class="flex items-center justify-between">
        <h3 class="font-semibold text-foreground flex items-center gap-2">
          <lucide-angular [img]="HouseIcon"></lucide-angular>
          Bâtiments
        </h3>
        <span class="badge badge-secondary">{{ buildings.length }}</span>
      </div>

      @if (selectedBuilding === undefined) {
        <p class="text-sm text-muted-foreground">Loading...</p>
      } @else {
        <select
          id="buildingSelect"
          [(ngModel)]="selectedBuilding"
          (ngModelChange)="selectBuilding.emit($event)"
          class="w-full p-2 border rounded"
        >
          @for (building of buildings; track building.id) {
            <option [ngValue]="building">{{ building.name }}</option>
          }
        </select>

        <button
          class="w-full btn btn-outline bg-primary/5 border-primary/20 text-primary mt-2"
          (click)="addBuilding.emit()"
        >
          Ajouter un nouveau bâtiment
        </button>
      }
    </div>

    <hr />

    <div class="space-y-3">
      <div class="flex items-center justify-between">
        <h3 class="font-semibold text-foreground flex items-center gap-2">
          <lucide-angular [img]="LayersIcon"></lucide-angular>
          Étages
        </h3>
        <span class="badge badge-secondary">{{ storeys.length }}</span>
      </div>

      <div class="space-y-2">
        @for (storey of storeys; track storey.id) {
          <div
            class="storey-item"
            [class.selected]="selectedStorey && storey.id === selectedStorey.id"
          >
            <button
              class="flex-1 text-left"
              (click)="selectStorey.emit(storey)"
            >
              <div class="font-medium text-sm text-foreground">
                {{ storey.name }}
              </div>
            </button>

            @if (storeys.length > 1) {
              <button
                class="btn btn-ghost text-destructive hover:bg-destructive/10"
                (click)="removeStorey.emit(storey)"
              >
                <lucide-angular
                  [img]="TrashIcon"
                  class="w-4 h-4"
                ></lucide-angular>
              </button>
            }
          </div>
        }
      </div>

      <button
        class="w-full btn btn-outline bg-primary/5 border-primary/20 text-primary mt-2"
        (click)="addStorey.emit()"
      >
        Ajouter un étage
      </button>
    </div>

    <hr />

    <div class="space-y-3 flex flex-col h-full min-h-0">
      <div class="flex items-center justify-between">
        <h3 class="font-semibold text-foreground flex items-center gap-2">
          <lucide-angular [img]="DoorOpenIcon"></lucide-angular>
          Pièces
        </h3>
        <span class="badge badge-secondary">{{ rooms.length }}</span>
      </div>

      <div class="space-y-2 max-h-[300px] overflow-y-auto px-1">
        @for (room of rooms; track room.id) {
          <div
            class="room-item"
            [class.selected]="selectedRoom.id === room.id"
            (click)="selectRoom.emit(room)"
            (keydown.enter)="selectRoom.emit(room)"
            tabindex="0"
          >
            <div
              class="color-preview"
              [style.backgroundColor]="
                selectedRoom.id === room.id ? editRoomColor : room.color
              "
            >
              @if (selectedRoom.id === room.id) {
                <input
                  type="color"
                  [(ngModel)]="editRoomColor"
                  class="color-input-hidden"
                  title="Changer la couleur"
                />
              }
            </div>

            <div class="room-name-container">
              @if (selectedRoom.id === room.id) {
                <input
                  [(ngModel)]="editRoomName"
                  (keydown.enter)="saveRoomEdit()"
                  class="room-name-input"
                  placeholder="Nom de la pièce"
                  (click)="$event.stopPropagation()"
                />
              } @else {
                <div class="room-name-text">
                  {{ room.name }}
                </div>
              }
            </div>

            <div class="room-actions">
              @if (selectedRoom.id === room.id) {
                <button
                  title="Sauvegarder"
                  (click)="saveRoomEdit(); $event.stopPropagation()"
                >
                  <lucide-angular
                    [img]="CheckIcon"
                    class="w-4 h-4"
                  ></lucide-angular>
                </button>
              }

              <button
                class="btn btn-ghost text-destructive hover:bg-destructive/10"
                (click)="removeRoom.emit(room); $event.stopPropagation()"
              >
                <lucide-angular
                  [img]="TrashIcon"
                  class="w-4 h-4"
                ></lucide-angular>
              </button>
            </div>
          </div>
        }
      </div>

      <button
        class="w-full btn btn-outline bg-primary/5 border-primary/20 text-primary mt-2"
        (click)="addRoom.emit()"
      >
        Ajouter une pièce
      </button>
    </div>

    <hr class="border-border/50" />

    <div class="space-y-3 flex flex-col h-full min-h-0">
      <div class="flex items-center justify-between">
        <h3 class="font-semibold text-foreground flex items-center gap-2">
          <lucide-angular [img]="ArmchairIcon"></lucide-angular>
          Meubles
        </h3>
        <span class="badge badge-secondary">{{ furnitures.length }}</span>
      </div>

      <div class="space-y-2 max-h-[300px] overflow-y-auto px-1">
        @for (furniture of furnitures; track furniture.id) {
          <div
            class="furniture-item"
            [class.selected]="selectedFurniture.id === furniture.id"
            (click)="
              selectFurniture.emit(furniture);
              furnitureService.openModal(furniture)
            "
            (keydown.enter)="
              selectFurniture.emit(furniture);
              furnitureService.openModal(furniture)
            "
            tabindex="0"
          >
            <div class="furniture-name-container">
              <div class="furniture-name-text">
                {{ furniture.name }}
              </div>
            </div>
          </div>
        }
      </div>

      <button
        class="w-full btn btn-outline bg-primary/5 border-primary/20 text-primary mt-2"
        (click)="furnitureService.openModal()"
      >
        Ajouter un meuble
      </button>
    </div>
  </div>
</div>

<app-furniture-add-form />
