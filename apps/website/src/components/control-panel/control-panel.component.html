<div
  class="card h-full flex flex-col relative bg-gradient-panel shadow-panel border-0"
>
  <div class="card-content flex-1 overflow-y-auto space-y-6">
    <div class="space-y-3 flex flex-col min-h-0 relative">
      <div class="flex items-center justify-between">
        <h3 class="font-semibold text-foreground flex items-center gap-2">
          <lucide-angular [img]="HouseIcon"></lucide-angular>
          Bâtiments
          <span class="badge badge-secondary">({{ buildings.length }})</span>
        </h3>
      </div>

      @if (buildings.length === 0) {
        <div class="p-2 text-center text-gray-500">Aucun bâtiment</div>
      } @else {
        <p-select
          inputId="buildingSelect"
          [(ngModel)]="selectedBuilding"
          (ngModelChange)="selectBuilding.emit($event)"
          [options]="buildings"
          optionLabel="name"
          dataKey="id"
          placeholder="Sélectionner un bâtiment"
          styleClass="w-full"
          [style]="{
            '--p-select-valid-border-color': '#d1d5db',
            '--p-select-valid-shadow': 'none',
          }"
        />
      }

      <p-speedDial
        [model]="buildingItems"
        direction="left"
        [radius]="80"
        type="linear"
        buttonClassName="p-button-sm p-button-text p-button-secondary"
        [style]="{ position: 'absolute', top: '0.2rem', right: '0rem' }"
        showIcon="pi pi-ellipsis-v"
        hideIcon="pi pi-times"
      ></p-speedDial>
    </div>

    <hr />

    <div class="space-y-3 relative">
      <div class="flex items-center justify-between">
        <h3 class="font-semibold text-foreground flex items-center gap-2">
          <lucide-angular [img]="LayersIcon"></lucide-angular>
          Étages
          <span class="badge badge-secondary">({{ storeys.length }})</span>
        </h3>
      </div>

      @if (storeys.length === 0) {
        <div class="p-2 text-center text-gray-500">
          @if (!selectedBuilding) {
            Sélectionnez un bâtiment
          } @else {
            Aucun étage
          }
        </div>
      } @else {
        <div class="flex flex-col gap-2">
          <p-select
            [options]="storeys"
            [(ngModel)]="selectedStorey"
            (ngModelChange)="selectStorey.emit($event)"
            optionLabel="name"
            dataKey="id"
            placeholder="Sélectionner un étage"
            class="w-full"
            [style]="{
              width: '100%',
              '--p-select-valid-border-color': '#d1d5db',
              '--p-select-valid-shadow': 'none',
            }"
          >
            <ng-template let-storey pTemplate="item">
              <div
                class="flex align-items-center justify-content-between w-full"
              >
                <span>{{ storey.name }}</span>
              </div>
            </ng-template>
          </p-select>

          <div class="mb-2 flex items-center gap-2">
            <p-checkbox
              inputId="hideStoreys"
              [binary]="true"
              [ngModel]="hideNotSelectedStoreys"
              (onChange)="toggleHideNotSelectedStoreys.emit($event.checked)"
            />
            <label for="hideStoreys" class="ml-2"
              >Cacher les étages non sélectionnés</label
            >
          </div>
        </div>

        <input
          type="file"
          accept="image/*"
          #fileInput
          style="display: none"
          (change)="onFloorPlanSelected($event)"
        />
      }
      <p-speedDial
        [model]="storeyItems"
        direction="left"
        [radius]="80"
        type="linear"
        buttonClassName="p-button-sm p-button-text p-button-secondary"
        [style]="{
          position: 'absolute',
          top: '0.2rem',
          right: '0rem',
          zIndex: 50,
        }"
        showIcon="pi pi-ellipsis-v"
        hideIcon="pi pi-times"
        *ngIf="storeys.length > 0 || selectedBuilding"
      ></p-speedDial>
    </div>

    <hr />

    <div class="space-y-3 flex flex-col min-h-0 relative">
      <div class="flex items-center justify-between">
        <h3 class="font-semibold text-foreground flex items-center gap-2">
          <lucide-angular [img]="DoorOpenIcon"></lucide-angular>
          Pièces
          <span class="badge badge-secondary">({{ rooms.length }})</span>
        </h3>
      </div>

      @if (rooms.length === 0) {
        <div class="p-2 text-center text-gray-500">
          @if (!selectedStorey) {
            Sélectionnez un étage
          } @else {
            Aucune pièce
          }
        </div>
      } @else {
        <div class="flex flex-col gap-2">
          <p-select
            [options]="rooms"
            [(ngModel)]="selectedRoom"
            (ngModelChange)="selectRoom.emit($event)"
            optionLabel="name"
            dataKey="id"
            placeholder="Sélectionner une pièce"
            class="w-full"
            [style]="{
              width: '100%',
              '--p-select-valid-border-color': '#d1d5db',
              '--p-select-valid-shadow': 'none',
            }"
          >
            <ng-template let-room pTemplate="item">
              <div class="flex align-items-center gap-2">
                <div
                  class="w-4 h-4 rounded-full border border-gray-300"
                  [style.backgroundColor]="room.color"
                ></div>
                <span>{{ room.name }}</span>
              </div>
            </ng-template>
            <ng-template let-room pTemplate="selectedItem">
              <div class="flex align-items-center gap-2" *ngIf="room">
                <div
                  class="w-4 h-4 rounded-full border border-gray-300"
                  [style.backgroundColor]="room.color"
                ></div>
                <span>{{ room.name }}</span>
              </div>
            </ng-template>
          </p-select>
        </div>
      }
      <p-speedDial
        [model]="roomItems"
        direction="left"
        [radius]="80"
        type="linear"
        buttonClassName="p-button-sm p-button-text p-button-secondary"
        [style]="{
          position: 'absolute',
          top: '0.2rem',
          right: '0rem',
          zIndex: 50,
        }"
        showIcon="pi pi-ellipsis-v"
        hideIcon="pi pi-times"
        *ngIf="rooms.length > 0 || selectedStorey"
      ></p-speedDial>
    </div>

    <hr class="border-border/50" />

    <div class="space-y-3 flex flex-col min-h-0 relative">
      <div class="flex items-center justify-between">
        <h3 class="font-semibold text-foreground flex items-center gap-2">
          <lucide-angular [img]="ArmchairIcon"></lucide-angular>
          Meubles
          <span class="badge badge-secondary">({{ furnitures.length }})</span>
        </h3>
      </div>

      @if (furnitures.length === 0) {
        <div class="p-2 text-center text-gray-500">
          @if (!selectedRoom && !showAllStoreyFurnitures) {
            Sélectionnez une pièce
          } @else {
            Aucun meuble
          }
        </div>
      } @else {
        <div class="flex flex-col gap-2">
          <p-select
            [options]="furnitures"
            [(ngModel)]="selectedFurniture"
            (ngModelChange)="selectFurniture.emit($event)"
            optionLabel="name"
            dataKey="id"
            placeholder="Sélectionner un meuble"
            class="w-full"
            [style]="{
              width: '100%',
              '--p-select-valid-border-color': '#d1d5db',
              '--p-select-valid-shadow': 'none',
            }"
          ></p-select>

          <div class="mb-2 flex items-center gap-2">
            <p-checkbox
              inputId="showAllFurnitures"
              [binary]="true"
              [ngModel]="showAllStoreyFurnitures"
              (onChange)="toggleShowAllStoreyFurnitures.emit($event.checked)"
            />
            <label for="showAllFurnitures" class="ml-2 text-sm"
              >Afficher tous les meubles de l'étage</label
            >
          </div>
        </div>
      }

      <p-speedDial
        [model]="furnitureItems"
        direction="left"
        [radius]="80"
        type="linear"
        buttonClassName="p-button-sm p-button-text p-button-secondary"
        [style]="{
          position: 'absolute',
          top: '0.2rem',
          right: '0rem',
          zIndex: 50,
        }"
        showIcon="pi pi-ellipsis-v"
        hideIcon="pi pi-times"
        *ngIf="furnitures.length > 0 || selectedRoom"
      ></p-speedDial>
    </div>

    <hr class="border-border/50" />

    <p-button
      label="Scanner QR Code"
      icon="pi pi-qrcode"
      class="w-full btn btn-outline flex items-center justify-center gap-2"
      (click)="qrScanService.openScanModal()"
      title="Scanner un QR code pour localiser un meuble"
    >
    </p-button>
  </div>
</div>

<app-furniture-add-form
  [furniture]="furnitureService.furnitureToEdit"
  [defaultBuildingId]="selectedBuilding?.id"
  [defaultStoreyId]="selectedStorey?.id"
  [defaultRoomId]="selectedRoom?.id"
/>
