<app-header />

<div class="furniture-list-container">
  <div class="furniture-list-header">
    <h2>
      Il y a actuellement {{ furnitureService.furnitures.length }} meuble(s)
      affiché(s)
    </h2>
  </div>

  <div class="flex justify-center gap-4 mb-6">
    @if (roleService.currentRole === "Gestionnaire de mobilier") {
      <p-button
        label="Ajouter un meuble"
        styleClass="p-button-primary p-button-lg"
        (onClick)="openModal()"
      ></p-button>
    }

    @if (
      furnitureService.furnitures.length > 0 &&
      furnitureService.status !== "pending"
    ) {
      <p-button
        label="Exporter au format excel"
        (click)="exportToExcel()"
        styleClass="p-button-success p-button-lg"
      ></p-button>
    }
  </div>

  <app-search-engine />

  @if (roleService.currentRole === "Gestionnaire de site") {
    <div class="role-actions mb-4 flex justify-center">
      <p-button
        label="Voir notifications de déplacement"
        styleClass="p-button-pink p-button-lg"
        (onClick)="fakeNotify()"
      ></p-button>
    </div>
  }

  <app-furniture-add-form
    [furniture]="furnitureToEdit"
    (handleClose)="closeModal()"
  />

  <div class="furniture-list">
    @if (furnitureService.status === "pending") {
      <p>Chargement...</p>
    } @else {
      @for (furniture of furnitureService.furnitures; track furniture.id) {
        <div
          class="furniture-card relative overflow-hidden rounded-xl bg-white shadow-sm border border-gray-100 transition-all duration-300 hover:shadow-xl hover:-translate-y-1 cursor-pointer group"
          (click)="openModal(furniture.id)"
          tabindex="0"
          role="button"
        >
          <!-- Decorative Header / Image Placeholder -->
          <div
            class="h-32 bg-gradient-to-br from-indigo-50 to-blue-100 flex items-center justify-center relative overflow-hidden"
          >
            <!-- Background Pattern or texture could go here -->
            <div
              class="absolute inset-0 opacity-10 bg-[radial-gradient(#4f46e5_1px,transparent_1px)] [background-size:16px_16px]"
            ></div>

            <!-- Icon representing the furniture type if no image -->
            <i
              class="pi pi-box text-4xl text-indigo-300/50 group-hover:scale-110 transition-transform duration-500"
            ></i>

            <!-- Status Badge (Floating top right) -->
            <div class="absolute top-3 right-3">
              <span
                class="inline-block"
                [class]="getSeverityClasses(furniture.state)"
              >
                {{ furniture.state }}
              </span>
            </div>
          </div>

          <!-- Content Section -->
          <div class="p-5 flex flex-col gap-4">
            <!-- Header: Name & Type -->
            <div>
              <div class="flex justify-between items-start gap-2">
                <h2
                  class="font-bold text-lg text-gray-800 leading-tight group-hover:text-indigo-600 transition-colors line-clamp-2"
                >
                  {{ furniture.name }}
                </h2>
              </div>
              <span
                class="inline-block mt-1 text-xs font-medium text-indigo-500 bg-indigo-50 px-2 py-0.5 rounded-full"
              >
                {{ furniture.type }}
              </span>
            </div>

            <!-- Divider -->
            <div class="h-px bg-gray-100 w-full"></div>

            <!-- Location Details -->
            <div class="space-y-2 text-sm text-gray-600">
              <div class="flex items-center gap-2">
                <i class="pi pi-building text-gray-400"></i>
                <span class="truncate">
                  {{ furniture.building }}
                  <span class="text-gray-300 mx-1">|</span>
                  {{ furniture.storey }}
                </span>
              </div>
              <div class="flex items-center gap-2">
                <i class="pi pi-map-marker text-gray-400"></i>
                <span class="font-medium text-gray-700 truncate">
                  {{ furniture.room }}
                </span>
              </div>
            </div>
          </div>

          <!-- Hover Indicator (Bottom Bar) -->
          <div
            class="h-1 w-0 bg-indigo-500 transition-all duration-300 group-hover:w-full"
          ></div>
        </div>
      }
    }
  </div>
</div>
